{% extends 'base.html' %}

{% block content %}
<style>
    .medicines-header {
        background: linear-gradient(135deg, rgba(15, 118, 110, 0.98), rgba(20, 184, 166, 0.9));
        padding: 64px 0 72px;
        margin-bottom: -32px;
        position: relative;
        overflow: hidden;
    }

    .medicines-header::before {
        content: '';
        position: absolute;
        inset: 0;
        background:
            radial-gradient(600px 300px at 10% 10%, rgba(255, 255, 255, 0.18), transparent 60%),
            radial-gradient(450px 260px at 90% 20%, rgba(255, 255, 255, 0.12), transparent 60%);
    }

    .hero-badges {
        display: inline-flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 10px;
    }

    .hero-badge {
        padding: 6px 14px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.16);
        color: rgba(255, 255, 255, 0.95);
        font-size: 0.78rem;
        font-weight: 600;
        letter-spacing: 0.3px;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .search-box {
        max-width: 620px;
        margin: 22px auto 0;
        position: relative;
        z-index: 2;
    }

    .search-input {
        border-radius: 999px;
        padding: 14px 64px 14px 22px;
        border: 1px solid rgba(255, 255, 255, 0.4);
        box-shadow: 0 12px 30px rgba(15, 23, 42, 0.18);
        font-size: 0.95rem;
        background: rgba(255, 255, 255, 0.92);
    }

    .search-btn {
        position: absolute;
        right: 8px;
        top: 50%;
        transform: translateY(-50%);
        border-radius: 999px;
        padding: 8px 22px;
        background: linear-gradient(135deg, #f97316, #f43f5e);
        border: none;
        color: white;
        font-weight: 600;
        font-size: 0.88rem;
        box-shadow: 0 8px 18px rgba(244, 63, 94, 0.25);
    }

    .stats-row {
        background: rgba(255, 255, 255, 0.9);
        border-radius: 18px;
        padding: 18px 22px;
        margin-bottom: 26px;
        box-shadow: 0 12px 40px rgba(15, 23, 42, 0.08);
        border: 1px solid rgba(148, 163, 184, 0.2);
        backdrop-filter: blur(8px);
    }

    .stat-item {
        text-align: center;
        padding: 8px;
    }

    .stat-number {
        font-size: 1.45rem;
        font-weight: 800;
        background: linear-gradient(135deg, #0f766e 0%, #14b8a6 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 4px;
    }

    .stat-label {
        font-size: 0.78rem;
        color: #64748b;
        font-weight: 600;
    }

    .filter-pills {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        justify-content: center;
        margin: 30px 0;
    }

    .filter-pill {
        padding: 10px 22px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.9);
        border: 1px solid rgba(148, 163, 184, 0.4);
        color: #334155;
        font-size: 0.84rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 6px 16px rgba(15, 23, 42, 0.08);
    }

    .filter-pill:hover, .filter-pill.active {
        background: linear-gradient(135deg, #0f766e, #14b8a6);
        color: white;
        border-color: transparent;
        transform: translateY(-2px);
        box-shadow: 0 12px 28px rgba(20, 184, 166, 0.28);
    }

    .medicine-card {
        border-radius: 20px;
        border: 1px solid rgba(148, 163, 184, 0.22);
        overflow: hidden;
        transition: all 0.35s ease;
        background: white;
        box-shadow: 0 8px 20px rgba(15, 23, 42, 0.08);
        height: 100%;
        cursor: pointer;
        text-decoration: none;
        display: block;
        color: inherit;
    }

    .medicine-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 18px 40px rgba(15, 23, 42, 0.16);
    }

    .medicine-card-header {
        padding: 20px 20px 16px;
        background: linear-gradient(160deg, rgba(248, 250, 252, 0.98), rgba(226, 232, 240, 0.9));
        border-bottom: 3px solid;
        position: relative;
    }

    .medicine-icon {
        width: 52px;
        height: 52px;
        border-radius: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        margin-bottom: 12px;
        box-shadow: 0 8px 16px rgba(15, 23, 42, 0.12);
    }

    .category-pain .medicine-card-header { border-bottom-color: #f97316; }
    .category-pain .medicine-icon { background: linear-gradient(135deg, #fb923c 0%, #f97316 100%); }

    .category-antibiotic .medicine-card-header { border-bottom-color: #0ea5e9; }
    .category-antibiotic .medicine-icon { background: linear-gradient(135deg, #22d3ee 0%, #0ea5e9 100%); }

    .category-vitamin .medicine-card-header { border-bottom-color: #f59e0b; }
    .category-vitamin .medicine-icon { background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); }

    .category-cold .medicine-card-header { border-bottom-color: #14b8a6; }
    .category-cold .medicine-icon { background: linear-gradient(135deg, #2dd4bf 0%, #14b8a6 100%); }

    .category-digestive .medicine-card-header { border-bottom-color: #22c55e; }
    .category-digestive .medicine-icon { background: linear-gradient(135deg, #86efac 0%, #22c55e 100%); }

    .category-cardiovascular .medicine-card-header { border-bottom-color: #f43f5e; }
    .category-cardiovascular .medicine-icon { background: linear-gradient(135deg, #fb7185 0%, #f43f5e 100%); }

    .category-other .medicine-card-header { border-bottom-color: #64748b; }
    .category-other .medicine-icon { background: linear-gradient(135deg, #94a3b8 0%, #64748b 100%); }

    .medicine-title {
        font-size: 1.02rem;
        font-weight: 700;
        color: #0f172a;
        margin-bottom: 6px;
    }

    .medicine-generic {
        font-size: 0.8rem;
        color: #64748b;
        font-weight: 500;
    }

    .medicine-card-body {
        padding: 18px 20px 20px;
    }

    .medicine-desc {
        font-size: 0.86rem;
        color: #475569;
        line-height: 1.7;
        margin-bottom: 16px;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .medicine-tags {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        margin-bottom: 0;
    }

    .medicine-tag {
        font-size: 0.7rem;
        padding: 5px 10px;
        border-radius: 999px;
        background: #f1f5f9;
        color: #475569;
        font-weight: 600;
    }

    .view-detail-btn {
        display: none;
    }
</style>

<div class="medicines-header">
    <div class="container">
        <div style="position: relative; z-index: 2;">
            <h1 class="text-center text-white fw-bold mb-2" style="font-size: 2.7rem; letter-spacing: 0.6px;">è¯å“ç™¾ç§‘åº“</h1>
            <p class="text-center text-white-50 mb-0" style="font-size: 1rem;">æƒå¨è¯å“çŸ¥è¯†ä½“ç³»ï¼Œç»“æ„åŒ–æ£€ç´¢ä¸å®‰å¿ƒç”¨è¯æç¤º</p>
            <div class="hero-badges justify-content-center d-flex">
                <span class="hero-badge">æƒå¨æ¥æº</span>
                <span class="hero-badge">æ™ºèƒ½æ£€ç´¢</span>
                <span class="hero-badge">å®æ—¶æ›´æ–°</span>
            </div>
            <div class="search-box">
                <input type="text" class="form-control search-input" id="searchInput" placeholder="æœç´¢è¯å“åç§°ã€é€‚åº”ç—‡..." onkeyup="searchMedicines()">
                <button class="search-btn">æœç´¢</button>
            </div>
        </div>
    </div>
</div>

<div class="container my-5">
    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    <div class="stats-row">
        <div class="row">
            <div class="col-md-3 col-6">
                <div class="stat-item">
                    <div class="stat-number">{{ medicines|length }}</div>
                    <div class="stat-label">è¯å“æ€»æ•°</div>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="stat-item">
                    <div class="stat-number">7</div>
                    <div class="stat-label">è¯å“åˆ†ç±»</div>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="stat-item">
                    <div class="stat-number">100%</div>
                    <div class="stat-label">ä¸“ä¸šå®¡æ ¸</div>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="stat-item">
                    <div class="stat-number">24/7</div>
                    <div class="stat-label">éšæ—¶æŸ¥è¯¢</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- åˆ†ç±»ç­›é€‰ -->
    <div class="filter-pills">
        <button class="filter-pill active" data-cat="all" onclick="filterCategory('all')">å…¨éƒ¨</button>
        <button class="filter-pill" data-cat="pain" onclick="filterCategory('pain')">ğŸ’Š æ­¢ç—›é€€çƒ§</button>
        <button class="filter-pill" data-cat="antibiotic" onclick="filterCategory('antibiotic')">ğŸ¦  æŠ—èŒæ¶ˆç‚</button>
        <button class="filter-pill" data-cat="cold" onclick="filterCategory('cold')">ğŸ¤§ æ„Ÿå†’ç”¨è¯</button>
        <button class="filter-pill" data-cat="digestive" onclick="filterCategory('digestive')">ğŸ½ï¸ æ¶ˆåŒ–ç³»ç»Ÿ</button>
        <button class="filter-pill" data-cat="vitamin" onclick="filterCategory('vitamin')">ğŸŒŸ ç»´ç”Ÿç´ </button>
        <button class="filter-pill" data-cat="cardiovascular" onclick="filterCategory('cardiovascular')">â¤ï¸ å¿ƒè¡€ç®¡</button>
        <button class="filter-pill" data-cat="other" onclick="filterCategory('other')">ğŸ“‹ å…¶ä»–</button>
    </div>
    
    <!-- è¯å“åˆ—è¡¨ -->
    <div class="row row-cols-2 row-cols-md-4 g-3" id="medicinesGrid">
        {% for med in medicines %}
        {% if 'ç—›' in med.name or 'å¸ƒæ´›èŠ¬' in med.name or 'èŠ¬å¿…å¾—' in med.name or 'å¯¹ä¹™é…°æ°¨åŸºé…š' in med.name or 'é€€çƒ§' in med.indications %}
            {% set cat = 'pain' %}{% set icon = 'ğŸ’Š' %}
        {% elif 'æŠ—ç”Ÿç´ ' in med.indications or 'é˜¿è«è¥¿æ—' in med.name or 'å¤´å­¢' in med.name or 'é’éœ‰ç´ ' in med.name or 'æ¶ˆç‚' in med.indications or 'éœ‰ç´ ' in med.name or 'æ²™æ˜Ÿ' in med.name or 'ç£ºèƒº' in med.name %}
            {% set cat = 'antibiotic' %}{% set icon = 'ğŸ¦ ' %}
        {% elif 'æ„Ÿå†’' in med.name or 'æ„Ÿå†’' in med.indications %}
            {% set cat = 'cold' %}{% set icon = 'ğŸ¤§' %}
        {% elif 'ç»´ç”Ÿç´ ' in med.name or 'VB' in med.name or 'VC' in med.name or 'å¶é…¸' in med.name or 'é’™' in med.name %}
            {% set cat = 'vitamin' %}{% set icon = 'ğŸŒŸ' %}
        {% elif 'èƒƒ' in med.indications or 'æ¶ˆåŒ–' in med.indications or 'è‚ ' in med.indications %}
            {% set cat = 'digestive' %}{% set icon = 'ğŸ½ï¸' %}
        {% elif 'è¡€å‹' in med.indications or 'å¿ƒè„' in med.indications or 'å¿ƒè¡€ç®¡' in med.indications or 'å¿ƒç»ç—›' in med.indications or 'å† å¿ƒç—…' in med.indications or 'èƒ†å›ºé†‡' in med.indications %}
            {% set cat = 'cardiovascular' %}{% set icon = 'â¤ï¸' %}
        {% else %}
            {% set cat = 'other' %}{% set icon = 'ğŸ“‹' %}
        {% endif %}
        <div class="col medicine-item" data-category="{{ med.generic_name }}" data-name="{{ med.name|lower }}" data-indications="{{ med.indications|lower }}">
            <a href="{{ url_for('main.medicine_detail', medicine_id=med.id) }}" class="medicine-card category-{{ cat }}">
                <div class="medicine-card-header">
                    <div class="medicine-icon text-white">{{ icon }}</div>
                    <h5 class="medicine-title">{{ med.name }}</h5>
                    <p class="medicine-generic mb-0">{{ med.generic_name }}</p>
                </div>
                <div class="medicine-card-body">
                    <p class="medicine-desc">{{ med.indications }}</p>
                    <div class="medicine-tags">
                        <span class="medicine-tag">å¤„æ–¹è¯</span>
                        <span class="medicine-tag">å£æœ</span>
                    </div>
                </div>
            </a>
        </div>
        {% endfor %}
    </div>
</div>

<script>
// æ³¨å…¥å„åˆ†ç±»æ•°é‡å¾½æ ‡
document.addEventListener('DOMContentLoaded', function () {
    var total = document.querySelectorAll('.medicine-item').length;
    var allBtn = document.querySelector('.filter-pill[data-cat="all"]');
    if (allBtn) allBtn.innerHTML += ' <span style="display:inline-flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.28);border-radius:50px;padding:1px 9px;font-size:0.78rem;margin-left:5px;">' + total + '</span>';

    ['pain','antibiotic','cold','digestive','vitamin','cardiovascular','other'].forEach(function(cat){
        var count = document.querySelectorAll('.medicine-card.category-' + cat).length;
        var btn = document.querySelector('.filter-pill[data-cat="' + cat + '"]');
        if (btn) btn.innerHTML += ' <span style="display:inline-flex;align-items:center;justify-content:center;background:rgba(102,126,234,0.12);border-radius:50px;padding:1px 9px;font-size:0.78rem;margin-left:5px;color:inherit;">' + count + '</span>';
    });
});

function searchMedicines() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const items = document.querySelectorAll('.medicine-item');
    
    items.forEach(item => {
        const name = item.dataset.name;
        const indications = item.dataset.indications;
        
        if (name.includes(searchTerm) || indications.includes(searchTerm)) {
            item.style.display = '';
        } else {
            item.style.display = 'none';
        }
    });
}

function filterCategory(category) {
    // æ›´æ–°æŒ‰é’®çŠ¶æ€
    document.querySelectorAll('.filter-pill').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');
    
    // ç­›é€‰è¯å“
    const items = document.querySelectorAll('.medicine-item');
    items.forEach(item => {
        const card = item.querySelector('.medicine-card');
        if (category === 'all' || card.classList.contains('category-' + category)) {
            item.style.display = '';
        } else {
            item.style.display = 'none';
        }
    });
}
</script>
{% endblock %}
